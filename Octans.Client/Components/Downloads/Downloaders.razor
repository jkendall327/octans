@page "/downloaders"
@inject DownloadersViewmodel Viewmodel
@inject IDialogService DialogService
@using Octans.Core.Downloaders

<div class="downloaders-container">
    <div class="actions">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Rescan">Rescan</MudButton>
        <MudButton Variant="Variant.Text" StartIcon="@Icons.Material.Filled.Help" OnClick="ShowHelp">Help</MudButton>
    </div>
    <MudText Typo="Typo.body2">Looking for downloaders in: @Viewmodel.DownloaderDirectory</MudText>

    <MudTable Items="Viewmodel.Downloaders">
        <HeaderContent>
            <MudTh>Name</MudTh>
            <MudTh>Version</MudTh>
            <MudTh>Creator</MudTh>
            <MudTh>Homepage</MudTh>
            <MudTh>Supported Operations</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Name</MudTd>
            <MudTd>@context.Version</MudTd>
            <MudTd>@context.Creator</MudTd>
            <MudTd>
                @if (!string.IsNullOrWhiteSpace(context.Homepage))
                {
                    <a href="@context.Homepage" target="_blank">@context.Homepage</a>
                }
            </MudTd>
            <MudTd>
                @foreach (var op in context.SupportedOperations)
                {
                    <MudChip T="string" Size="Size.Small" Style="margin-right:4px;">@op</MudChip>
                }
            </MudTd>
        </RowTemplate>
    </MudTable>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        if (RendererInfo.IsInteractive)
        {
            await Viewmodel.Load();
        }
    }

    private async Task Rescan()
    {
        await Viewmodel.Rescan();
    }

    private async Task ShowHelp()
    {
        const string content = "Downloaders are bundles of Lua files that provide site-specific parsing and downloading functionality.<br/><br/>To add one, create a folder inside the directory shown above and include your Lua files.";

        await DialogService.ShowMessageBox("Downloaders", (MarkupString)content, yesText: "Close");
    }
}

<style>
    .downloaders-container .actions {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
</style>
